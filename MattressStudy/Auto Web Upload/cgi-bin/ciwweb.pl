#!/usr/bin/perl

# ---------------------------------------------------------------------------
#     CIWWEB.PL
#
#      Ver: 9_14_2
# ---------------------------------------------------------------------------
# Lighthouse Studio - Web Surveying System
# Copyright Sawtooth Software, Inc. 1998-2022. All rights reserved.
# Provo, UT  USA  (801) 477-4700
#
# Any modification of this script will be considered violation of
# copyright (with the exception of the first line which can be
# modified to reflect the correct path to the Perl interpreter)
# Any use of this script or its code for purposes outside of
# the systems created by Sawtooth Software is prohibited.
 use strict; package ssiwebciw9_14_2; if (exists($ENV{'MOD_PERL'}) && defined($ENV{'MOD_PERL'})) { ssiwebciw9_14_2::_qg(); } else { $SIG{"ALRM"} = \&ssiwebciw9_14_2::_qh; eval { alarm(180); ssiwebciw9_14_2::_qg(); alarm(0); }; if ($@) { my $error_msg = $@; eval { if ($error_msg =~ m/Sawtooth Software process time out/i) { my $long_msg = "Process timed out."; authlib9_14_2::_zq(312, $long_msg, $long_msg, $@, 0); } else { authlib9_14_2::_zq(313, "", "", $error_msg, 0); } }; if ($@) { die("Sawtooth Software Error."); } } } sub _qg { my $__a = 0; my $__b = ""; my $__c = ""; my $__d = 0; my $__e = 0; my $__f = 0; my $__g = 0; my $__h = 0; my $__i = ""; my $__j = ""; my $__k = ""; my $__l = 1; my $__m = ""; my $__n = 1; my $__o = 0; my $__p = ""; my $__q = 0; my $__r = 0; my $__s = 0; my $__t = 0; my $__u = 0; my $__v = ""; my $__w = 0; my $__x =0; my $__y = 0; if ($ENV{'PERLXS'} =~ m/PerlIS/i) { print "HTTP/1.1 200 OK\n"; } if ((exists($ENV{'SCRIPT_FILENAME'}) || (defined ($ENV{'SCRIPT_FILENAME'})))) { $__k = $ENV{'SCRIPT_FILENAME'}; } if ($__k eq "") { $__k = $ENV{'PATH_TRANSLATED'}; $__k =~ tr[\\][/]; } $__k =~ s/(.+)\/.+$/$1/; if ((exists($ENV{'SSI_UTF16'}) || (defined ($ENV{'SSI_UTF16'})))) { require Win32; utf8::decode($__k); $__k = Win32::GetShortPathName($__k); $__k =~ tr/\\/\//; } unshift @INC, $__k; _qk("authlib9_14_2.pl", $__k); authlib9_14_2::_wc(0); $authlib9_14_2::_aiz = $__k; _qk("ciwlib9_14_2.pl", $__k); ciwlib9_14_2::_ql(); authlib9_14_2::_wv(); authlib9_14_2::_yk(); if (exists $authlib9_14_2::_akn{"hid_preview"}) { $authlib9_14_2::_amg = $authlib9_14_2::_akn{"hid_preview"}; if (authlib9_14_2::_aet()) { $__d = 1; $authlib9_14_2::_akn{"hid_respnum"} = $__d; $ciwlib9_14_2::_tx{'_buc'} = $__d; } if (exists $authlib9_14_2::_akn{"hid_preview_page"} && $authlib9_14_2::_akn{"hid_preview_page"} > 1) { $__e = 1; } } if (!$authlib9_14_2::_amg) { if ($authlib9_14_2::_akn{"hid_previous"} == 1) { $authlib9_14_2::_ajq = 1; } elsif (exists $authlib9_14_2::_akn{"sys_previous_button"} && $authlib9_14_2::_akn{"sys_previous_button"} ne "") { $authlib9_14_2::_ajq = 1; } } if (keys(%authlib9_14_2::_akn) == 1 || exists $authlib9_14_2::_akn{"hid_url_restore"}) { if (exists $authlib9_14_2::_akn{"hid_s"}) { my $__z = $authlib9_14_2::_akn{"hid_s"}; if ($__z ne "") { my $__aa = 0; my $__ab = 0; my $__ac = 0; ($__v, $__s, $__i, $__t, $__aa, $__w, $__x, $__ab, $__ac) = authlib9_14_2::_xc($__z); $authlib9_14_2::_akn{"hid_studyname"} = $__i; if ($__aa) { $authlib9_14_2::_akn{"hid_test_mode"} = $__aa; } if ($__ac) { $authlib9_14_2::_akn{"hid_test_db"} = $__ac; } $__q = 1; } } } $__j = authlib9_14_2::_xi(0); if ((exists $authlib9_14_2::_akn{"hid_pagenum"}) && (defined $authlib9_14_2::_akn{"hid_pagenum"})) { $__e = $authlib9_14_2::_akn{"hid_pagenum"}; } if ($__e == 1 || $__e == 0) { my $__ad = ""; foreach $__ad (keys %authlib9_14_2::_akn) { $authlib9_14_2::_ahr{uc($__ad)} = $authlib9_14_2::_akn{$__ad}; } } if ((exists $authlib9_14_2::_akn{"hid_studyname"}) && (defined $authlib9_14_2::_akn{"hid_studyname"})) { $__i = $authlib9_14_2::_akn{"hid_studyname"}; } elsif (exists $authlib9_14_2::_ahr{"STUDYNAME"}) { $__y = 1; $authlib9_14_2::_akn{"hid_studyname"} = $authlib9_14_2::_ahr{"STUDYNAME"}; $__i = $authlib9_14_2::_akn{"hid_studyname"}; } else { if ($__i eq "") { $__i = authlib9_14_2::_acr("hid_studyname"); if ($__i eq "") { $__i = authlib9_14_2::_zs(); if ($__i eq "") { authlib9_14_2::_zq(102, "", "Study name passed in is empty. Cannot find study name.", "", 1); } } } } if ($__i =~ m/\W/g) { authlib9_14_2::_zq(327, "Access error.", "The studyname passed in contains invalid characters.", "", 0); } authlib9_14_2::_wy($__i); authlib9_14_2::_zl($__k); $authlib9_14_2::_ajw = authlib9_14_2::_xs(); my ($__ci, $__cj, $__ck) = authlib9_14_2::_wd($authlib9_14_2::_ajw); if (!$__ci) { authlib9_14_2::_zq(199, "Database error.", $__cj, $__ck); } my $__ae = 0; ($__ci, $__cj, $__ck, $__ae) = authlib9_14_2::_xq(0); if (!$__ci) { authlib9_14_2::_zq(204, "Database error.", $__cj, $@); } if (!exists $authlib9_14_2::_akn{"hid_javascript"} && !$authlib9_14_2::_amg && !$__q && !exists $authlib9_14_2::_akn{"sys_input"} && !exists $authlib9_14_2::_akn{"sys_acbc_byo_request"}) { if ($__y == 1) { $__e = 1; } else { $__e = authlib9_14_2::_acr("hid_pagenum"); if ($__e eq "") { $__e = 0; } } ciwlib9_14_2::_qm($__e, $__i); } if ($__q) { my $__af = 0; if ($__s) { my $__ag = ciwlib9_14_2::_sd($__s); if ($__ag) { if (exists $__ag->{"resp_num"}) { $authlib9_14_2::_akn{"hid_respnum"} = $__ag->{"resp_num"}; } if (exists $__ag->{"last_question"}) { $__m = $__ag->{"last_question"}; } else { $__m = authlib9_14_2::_ws("sys_LastQuestion"); } if ($__t) { $authlib9_14_2::_akn{"hid_checksum"} = $__t; } else { $authlib9_14_2::_akn{"hid_checksum"} = authlib9_14_2::_ws("sys_CheckSum"); } if (!exists $authlib9_14_2::_akn{"hid_test_mode_settings"} && exists $__ag->{"test_mode_settings"}) { $authlib9_14_2::_akn{"hid_test_mode_settings"} = $__ag->{"test_mode_settings"}; } if (exists $__ag->{"preview"}) { $authlib9_14_2::_akn{"hid_preview"} = $__ag->{"preview"}; $authlib9_14_2::_amg = $__ag->{"preview"}; } if ($__v == 0xFF01) { if ($__t != $__ag->{"checksum"} || $__w != $__ag->{"timestamp"} || $__x != $__ag->{"resp_num"} || $authlib9_14_2::_akh != $__ag->{"study_name"} || $authlib9_14_2::_akn{"hid_test_mode"} != $__ag->{"test_mode"}) { my $__ah = "Expected_checksum=" . $__ag->{"checksum"} . ", actual_checksum=$__t"; $__ah .= ", expected_timestamp=" . $__ag->{"timestamp"} . ", actual_timestamp=$__w"; $__ah .= ", expected_respnum=" . $__ag->{"resp_num"} . ", actual_respnum=$__x"; $__ah .= ", expected_studyname=" . $__ag->{"study_name"} . ", actual_studyname=$__i"; $__ah .= ", version=$__v, id=$__s"; authlib9_14_2::_zq(310, "URL values do not match expected values.", $__ah, ""); } } elsif ($__v == 0xFF02) { if ($__t != $__ag->{"checksum"} || $__w != $__ag->{"timestamp"} || $__x != $__ag->{"resp_num"} || $authlib9_14_2::_akh != $__ag->{"study_name"} || $authlib9_14_2::_akn{"hid_test_mode"} != $__ag->{"test_mode"}) { my $__ah = "Expected_checksum=" . $__ag->{"checksum"} . ", actual_checksum=$__t"; $__ah .= ", expected_timestamp=" . $__ag->{"timestamp"} . ", actual_timestamp=$__w"; $__ah .= ", expected_respnum=" . $__ag->{"resp_num"} . ", actual_respnum=$__x"; $__ah .= ", expected_studyname=" . $__ag->{"study_name"} . ", actual_studyname=$__i"; $__ah .= ", version=$__v, id=$__s"; authlib9_14_2::_zq(326, "URL values do not match expected values.", $__ah, ""); } } } elsif ($authlib9_14_2::_amg) { $__af = 1; } } $__n = 0; $__l = 0; $__e = -1; $__d = $authlib9_14_2::_akn{"hid_respnum"}; if ($__af) { $__e = 0; } } if ($__j ne "") { authlib9_14_2::_acg(&authlib9_14_2::_AOU, 0, $__j); } if (exists $authlib9_14_2::_akn{"hid_test_mode"} && exists $authlib9_14_2::_akn{"hid_test_mode_settings"}) { if ($authlib9_14_2::_akn{"hid_test_mode_settings"} eq "") { ciwlib9_14_2::_tb(); } if ($authlib9_14_2::_akn{"hid_test_mode_settings"} ne "") { ciwlib9_14_2::_tc(); } } if (exists $authlib9_14_2::_akn{"hid_loadtest_mode"}) { $authlib9_14_2::_ajg = $authlib9_14_2::_akn{"hid_loadtest_mode"}; } authlib9_14_2::_yl(0, 1, ""); if ($authlib9_14_2::_akm->{"survey_paused"} == 1) { ciwlib9_14_2::_ro('_of', 1); } if ($authlib9_14_2::_ajq) { $__d = ciwlib9_14_2::_rj(); my @__ai = (); foreach my $__aj (grep(/hid_prev_/, (keys %authlib9_14_2::_akn))) { my ($__cl,$__cm, $__cf, $__cn) = split(",", $authlib9_14_2::_akn{$__aj}); push(@__ai, [ $__cm, $__cl ]); delete $authlib9_14_2::_akn{$__aj}; } @__ai = sort {$a->[1] <=> $b->[1]} @__ai; my @__ak = reverse @{authlib9_14_2::_xy($__d)}; my @__al = grep { $_->{"quest_version"} ne "0" } @__ak; @__ak = grep { $_->{"limbo"} == 0 } @__ak; if ($__e > 1 && exists $authlib9_14_2::_akn{"hid_pagetime"} && !$authlib9_14_2::_amg) { my @__am = (); ciwlib9_14_2::_rl(\@__am, $__d, $__e, $authlib9_14_2::_akn{"hid_pagetime"}); authlib9_14_2::_xv(\@__am, $__d, 1, 1); authlib9_14_2::_xj(\@__am, $__d, 0); } if (@__ak == 0 || @__al == 0) { $__e = 0; } else { my $__an = -1; my $__ao = 0; if ($__al[0]->{"hop"} < $__ai[0]->[1]) { $__ao = $__al[0]; $__an = 0; } else { for (my $__ap = 0; $__ap < @__al; $__ap++) { if ($__al[$__ap]->{"hop"} <= $__ai[0]->[1]) { if ($__ap + 1 < @__al) { $__ao = $__al[$__ap + 1]; $__an = $__ap + 1; last; } } } } if ($__ao) { my $__aq = 0; if (exists $__ao->{"hop"}) { $__aq = $__ao->{"hop"}; } else { authlib9_14_2::_zq(260, "Backup Error.", "Error occured while backing up.", $@); } $__e = $__ao->{"page_num"}; $__u = $authlib9_14_2::_ako->[$__e - 1]; my @__ar = (); my $__as = ""; if ($__e > 1) { while (1) { eval { $__as = "SELECT `hop`,`quest_name` FROM `" . $authlib9_14_2::_akj . "_history` WHERE `sys_RespNum`=" . $__d . " AND `page_num`=" . $__e . " AND `quest_version`!='0' AND `limbo`=0 AND `hop` <= $__aq ORDER BY `hop` ASC"; @__ar = @{$authlib9_14_2::_ake->selectall_arrayref(authlib9_14_2::_wn($__as, 0), { Slice => {} })}; }; if ($@) { authlib9_14_2::_zq(234, "Database error.", "Unable to read history data. " . $authlib9_14_2::_ake->errstr, $@); } if (@__ar == 0) { if ($__an < @__al) { $__ao = $__al[++$__an]; if (exists $__ao->{"hop"}) { $__aq = $__ao->{"hop"}; $__e = $__ao->{"page_num"}; $__u = $authlib9_14_2::_ako->[$__e - 1]; } else { authlib9_14_2::_zq(260, "Backup Error.", "Error occured while backing up.", $@); } } else { last; } } else { last; } } if (@__ar == 0) { $__e = 0; } else { my $__at = 0; my $__au = $__u->{'_ld'}; my $__av = @{$__au}; my %__aw = (); my $__ax = 2147483648; my $__ay = $__ax; for (my $__az = 0; $__az < $__av; $__az++) { my $__ba = $__au->[$__az]; $__aw{$__ba->{'_if'}} = $__ax; } $__at = @__ar - 1; for (my $__ap = @__ar - 1; $__ap >= 0; $__ap--) { my $__bb = ""; if ($__ar[$__ap]->{"quest_name"} =~ m/^(.*?)\..*$/o) { $__bb = $1; } else { $__bb = $__ar[$__ap]->{"quest_name"}; } if (exists $__aw{$__bb}) { if ($__aw{$__bb} == $__ax) { $__aw{$__bb} = $__ar[$__ap]->{"hop"}; } else { last; } if ($__ar[$__ap]->{"hop"} < $__ay) { $__ay = $__ar[$__ap]->{"hop"}; } } } for (my $__ap = 0; $__ap < $__av; $__ap++) { my $__bc = $__au->[$__ap]->{'_if'}; if (exists $__aw{$__bc} && $__aw{$__bc} != $__ax) { $__m = $__bc; last; } } $authlib9_14_2::_akn{"sys_prev_low_hop"} = $__ay; my @__bd = (); for (my $__ap = 0; $__ap < @__ak; $__ap++) { if ($__ak[$__ap]->{"hop"} eq $__ay) { @__bd = (@__bd, (0..$__ap)); last; } } my %__be = (); if (&authlib9_14_2::_ANA) { authlib9_14_2::_yo(); if ($authlib9_14_2::_aky && exists $authlib9_14_2::_aky->{'_jr'}) { foreach my $__bf(@{$authlib9_14_2::_aky->{'_jr'}}) { $__be{$__bf->{'_if'}} = 1; } } } foreach my $__ap (@__bd) { foreach my $__bg (keys %{$__ak[$__ap]->{"data"}}) { if (&authlib9_14_2::_ANA) { if (!exists $__be{$__bg}) { $authlib9_14_2::_aht->{$__bg} = 1; } } else { $authlib9_14_2::_aht->{$__bg} = 1; } } } my $__bh = 0; eval { my $__as = "SELECT * FROM `" . $authlib9_14_2::_akj . "_history` WHERE `sys_RespNum`=" . $__d . " AND `page_num`=" . $__e . " AND `quest_name`='hid_page_vars_history' AND `limbo`=0 AND `hop`>= " . $__aq . " ORDER BY `hop` ASC"; my @__bi = @{$authlib9_14_2::_ake->selectall_arrayref(authlib9_14_2::_wn($__as, 0), { Slice => {} })}; if (@__bi > 0) { $__bh = $__bi[0]; } }; if ($@) { authlib9_14_2::_zq(279, "Database error.", "Unable to connect retrieve history data. " . $authlib9_14_2::_ake->errstr, $@); } delete $authlib9_14_2::_akn{"hid_loops"}; delete $authlib9_14_2::_akn{"hid_page_rand"}; if ($__bh) { eval { $__bh->{"data"} = eval(authlib9_14_2::_wi($__bh->{"data"})); }; if ($@) { authlib9_14_2::_zq(280, "Database error.", "Database error while evaluating history.", $@); } if (exists $__bh->{"data"}->{"hid_SavedListNames"}) { my @__bj = split(",", $__bh->{"data"}->{"hid_SavedListNames"}); delete $__bh->{"data"}->{"hid_SavedListNames"}; my $__bk = ""; foreach $__bk (@__bj) { $authlib9_14_2::_ait{$__bk} = $__bh->{"data"}->{$__bk}; delete $authlib9_14_2::_aht->{$__bk}; delete $__bh->{"data"}->{$__bk}; } } %authlib9_14_2::_ajn = (%authlib9_14_2::_ajn, %{$__bh->{"data"}}); if (exists $authlib9_14_2::_ajn{"hid_loops"}) { $authlib9_14_2::_akn{"hid_loops"} = $authlib9_14_2::_ajn{"hid_loops"}; } if (exists $authlib9_14_2::_ajn{"hid_page_rand"}) { $authlib9_14_2::_akn{"hid_page_rand"} = $authlib9_14_2::_ajn{"hid_page_rand"}; } } } } else { $__e = 0; } } else { $__e = 0; } } } if (exists $authlib9_14_2::_akn{"sys_acbc_byo_request"}) { my $__bl = $authlib9_14_2::_akn{"sys_acbc_name"}; $__d = ciwlib9_14_2::_rj(); my $__bm = authlib9_14_2::_aao($__bl); print acbclib9_14_2::_bhp($__bm); exit(); } if (exists $authlib9_14_2::_akn{"sys_input"}) { print authlib9_14_2::_zb(); print authlib9_14_2::_yq(); exit(); } if ((exists $authlib9_14_2::_akn{"hid_javascript"}) && (defined $authlib9_14_2::_akn{"hid_javascript"})) { $__g = $authlib9_14_2::_akn{"hid_javascript"}; } elsif ($authlib9_14_2::_amg) { $__g = 1; } else { $__g = authlib9_14_2::_acr("hid_javascript"); if ($__g eq "") { $__g = 0; } } if (($__e == 0 || $__e == 1) && $authlib9_14_2::_ajg != 1) { if ($__g == 0) { authlib9_14_2::_acg(&authlib9_14_2::_AOU, 0, "Respondent denied survey access because their browser did not have JavaScript enabled (" . authlib9_14_2::_zz() . ")."); ciwlib9_14_2::_ro('_gp', 0); } if (exists $authlib9_14_2::_akn{"unsupported_browser"} && !exists $authlib9_14_2::_akp->{'_p'}) { authlib9_14_2::_acg(&authlib9_14_2::_AOU, 0, "Respondent denied survey access because they were using an unsupported browser (" . authlib9_14_2::_zz() . ")."); ciwlib9_14_2::_ro('_pm', 0); } } $authlib9_14_2::_akn{"hid_javascript"} = $__g; if ($__e > 1 && $authlib9_14_2::_ajq == 0) { $__d = ciwlib9_14_2::_rj(); } elsif ($__e == 1) { my $__bn = ""; authlib9_14_2::_yh("enterlib9_14_2.pl"); if ($authlib9_14_2::_akm->{"close_survey"} == 1) { enterlib9_14_2::_aps($__g, 0); } elsif ($authlib9_14_2::_aku && authlib9_14_2::_zh(0) >= &authlib9_14_2::_APJ) { enterlib9_14_2::_aps($__g, 1); } elsif ($authlib9_14_2::_akv && authlib9_14_2::_zh(1) >= &authlib9_14_2::_APK) { $authlib9_14_2::_akm->{"close_survey"} = 1; authlib9_14_2::_xr(); enterlib9_14_2::_aps($__g, 0); } elsif ($authlib9_14_2::_akw && authlib9_14_2::_zh(1) >= &authlib9_14_2::_APL) { $authlib9_14_2::_akm->{"close_survey"} = 1; authlib9_14_2::_xr(); enterlib9_14_2::_aps($__g, 0); } authlib9_14_2::_yo(); if ($authlib9_14_2::_aky && !$authlib9_14_2::_amg) { if (exists $authlib9_14_2::_aky->{'_ju'}) { my $__bo = 0; my $__bp = 0; ($__bo, $__bp, $__d, $__bn) = enterlib9_14_2::_apm($authlib9_14_2::_aky->{'_ju'}); if (!$__bo) { authlib9_14_2::_acg(&authlib9_14_2::_AOU, 0, "Respondent denied survey access because their password was wrong."); ciwlib9_14_2::_ro('_gf', 0); } elsif (!$__bp) { if ($__d) { $authlib9_14_2::_akn{"hid_respnum"} = $__d; } authlib9_14_2::_acg(&authlib9_14_2::_AOU, 0, "Respondent denied survey access because the password had reached the maximum number of respondents allowed."); ciwlib9_14_2::_ro('_js', 0); } } if ($__d == 0 && exists $authlib9_14_2::_aky->{'_mp'}) { if (!exists $authlib9_14_2::_akn{"hid_test_mode"}) { $__d = enterlib9_14_2::_apn($__k); } } } if (exists($authlib9_14_2::_akp->{'_nt'}) && !exists($authlib9_14_2::_akn{"hid_skip_simple_browser_transition"}) && $__g) { ciwlib9_14_2::_th($authlib9_14_2::_akp->{'_nt'}); authlib9_14_2::_act(); } my $__bq = 0; if (exists $ciwlib9_14_2::_tx{'_buc'}) { $__bq = 1; } elsif ($__d) { $authlib9_14_2::_akn{"hid_respnum"} = $__d; $__f = 1; } elsif (exists $authlib9_14_2::_akn{"hid_respnum"}) { $__d = ciwlib9_14_2::_rj(); } else { $__bq = 1; } if ($__f) { $__m = authlib9_14_2::_ws("sys_LastQuestion"); if (exists $authlib9_14_2::_ahr{"SYS_SKIPTO"}) { $__m = $authlib9_14_2::_ahr{"SYS_SKIPTO"}; $__m = ciwlib9_14_2::_so($__m); $__n = 0; $__o = 1; } $__m = ciwlib9_14_2::_sm($__d, $__m); } elsif ($__bq) { if (exists $ciwlib9_14_2::_tx{'_buc'}) { $__d = $ciwlib9_14_2::_tx{'_buc'}; } ($__d, $__r) = enterlib9_14_2::_apq($__d, $__bn, $__g); if ($authlib9_14_2::_aky) { if (exists $authlib9_14_2::_aky->{'_mp'} && $__a != 1) { if (!exists $authlib9_14_2::_akn{"hid_test_mode"}) { enterlib9_14_2::_apo($__d, $__r, $__k); } } } } if ($__d) { $authlib9_14_2::_akn{"hid_respnum"} = $__d; } else { authlib9_14_2::_zq(271, "", "Respondent number is empty.", ""); } } elsif ($__e == 0) { $authlib9_14_2::_akn{"hid_javascript"} = 1; ciwlib9_14_2::_rr(1, "", 0, 1, $authlib9_14_2::_akh, 0, 0); authlib9_14_2::_act(); } if ($__e == 1 && $__f) { $authlib9_14_2::_akn{"hid_checksum"} = authlib9_14_2::_ws("sys_CheckSum"); } if ($__q) { my $__br = ""; my $__bs = ""; if (exists $authlib9_14_2::_akp->{'_pr'}) { $__br = authlib9_14_2::_aab(); $__bs = authlib9_14_2::_ws("sys_UserAgent"); } my $__bt = ""; my $__bu = ""; if (exists $authlib9_14_2::_akp->{'_gh'}) { $__bt = authlib9_14_2::_aac(); $__bu = authlib9_14_2::_ws("sys_IPAddress"); } if (!$authlib9_14_2::_amg && ($__br ne $__bs || $__bt ne $__bu)) { authlib9_14_2::_zq(302, "The link to the survey that you are using will not work. Please enter the survey again using the original link that was given to you.", "A respondent attempted to use the survey page url with a different browser or IP address than they used originally. They were instructed to enter the survey using the original link that was sent to them.", "", 1); } if ($__m) { $__m = ciwlib9_14_2::_sm($__d, $__m); } } my $__bv = authlib9_14_2::_ws("sys_RespStatus"); if ($__bv == &authlib9_14_2::_AOH || $__bv == &authlib9_14_2::_AOG) { ciwlib9_14_2::_ro('_eo', 0); } if ($__g == 0) { if (authlib9_14_2::_ws("sys_UserJavaScript") == 1) { $__g = 1; $authlib9_14_2::_akn{"hid_javascript"} = $__g; } } if ($__e > 0 && $authlib9_14_2::_ajq == 0 && !$authlib9_14_2::_amg) { authlib9_14_2::_yh("pverlib9_14_2.pl"); my $__bw = authlib9_14_2::_acv(\%authlib9_14_2::_ait); my $__bx = authlib9_14_2::_acv($authlib9_14_2::_akg); my $__by = authlib9_14_2::_acv(\%authlib9_14_2::_ajn); my $__bz = authlib9_14_2::_acv(\%authlib9_14_2::_akn); pverlib9_14_2::_aqq($__e, $__d); %authlib9_14_2::_ait = %{$__bw}; $authlib9_14_2::_akg = $__bx; %authlib9_14_2::_ajn = %{$__by}; %authlib9_14_2::_akn = %{$__bz}; $authlib9_14_2::_aji = ""; $authlib9_14_2::_aix = 0; $authlib9_14_2::_ain = {}; } my $__ca = []; my $__cb = []; if ($ciwlib9_14_2::_tz && $authlib9_14_2::_ajq) { if ($__f) { $__m = ""; } if ($authlib9_14_2::_akn{"hid_destination"}) { $__m = $authlib9_14_2::_akn{"hid_destination"}; } } else { if ($__f) { if ($authlib9_14_2::_aja) { my $__cc = 0; my $__cd = ""; ($__cc, $__cd) = authlib9_14_2::_yw($__d); if ($__cc) { $__m = $__cd; delete $authlib9_14_2::_akn{"hid_page_rand"}; } } if (&authlib9_14_2::_ANA) { $__l = 1; } else { if (!$__o) { $__h = _qi(); if ($__h) { $__m = ""; delete $authlib9_14_2::_akn{"hid_page_rand"}; $__f = 0; } else { $__l = 0; } } } } if ($__l && $authlib9_14_2::_ajq == 0 && $ciwlib9_14_2::_tz eq "" && !$authlib9_14_2::_amg) { ($__ca, $__cb) = ciwlib9_14_2::_rk($__e, $__f); } } my $__ce = 0; if ($authlib9_14_2::_amg) { if ($authlib9_14_2::_akn{"hid_previous"} == 1) { $__e--; } else { $__e++; } } else { if ($ciwlib9_14_2::_tz eq "" && $__n && $authlib9_14_2::_ajq == 0) { ($__m, $__e, $__ce) = ciwlib9_14_2::_qn($__ca, $__cb, $__d, $__m, $__e, $__f); } } if (exists($ciwlib9_14_2::_tx{'skip'})) { if ($ciwlib9_14_2::_tz eq "") { $__m = $ciwlib9_14_2::_tx{'skip'}; $__m = ciwlib9_14_2::_sm($__d, $__m); $authlib9_14_2::_akn{"hid_test_mode_settings"} =~ s/(.*?),/,/; } } if ($authlib9_14_2::_ajq) { $authlib9_14_2::_ale = 0; $authlib9_14_2::_alf = 0; ($__e, $__m, $__ce) = ciwlib9_14_2::_rr($__e, $__m, $__d, $__g, $authlib9_14_2::_akh, 0, 0); if ($__e || $__m) { authlib9_14_2::_zq(308, "Backing up error.", "Backing up error. A destination was set while backing up. PageNum:" . $__e . " Destination:" . $__m, ""); } } else { my $__cf = $authlib9_14_2::_akn{'hid_pagenum'}; while ($__e > 0 || $__m ne "") { $authlib9_14_2::_alf = 0; $authlib9_14_2::_ale = 0; if (!$authlib9_14_2::_amg && !$__f && $ciwlib9_14_2::_tz eq "") { ($__e, $__m) = ciwlib9_14_2::_rq($__e, $__cf, $__m, $__d, $__ce); } elsif ($authlib9_14_2::_amg == &authlib9_14_2::_AOV && exists $authlib9_14_2::_akn{"hid_preview_page"}) { $__e = $authlib9_14_2::_akn{"hid_preview_page"}; } $__cf = $__e; ($__e, $__m, $__ce) = ciwlib9_14_2::_rr($__e, $__m, $__d, $__g, $authlib9_14_2::_akh, 0, 0); if (exists $authlib9_14_2::_akn{'sys_autocompletes'}) { my $__cg = ciwlib9_14_2::_rh($__cf); foreach my $__ch (@{$__cg}) { ($__ca, $__cb) = ciwlib9_14_2::_rk($__ch, 0); ($__m, $__e, $__ce) = ciwlib9_14_2::_qn($__ca, $__cb, $__d, $__m, $__ch, 0); } } elsif (($__e > 0 || $__m ne "") && (keys %authlib9_14_2::_ajn || keys %authlib9_14_2::_ait)) { my $__cg = ciwlib9_14_2::_rh($__cf); foreach my $__ch (@{$__cg}) { ciwlib9_14_2::_rk($__ch, 0); } } } } authlib9_14_2::_act(); } sub _qh { my $__co = ""; my $__cp = "Sawtooth Software process time out."; eval { if (!$authlib9_14_2::_amg) { $__co = $__cp; } }; if ($@) { $__co = $__cp; } if ($__co) { die($__co); } } sub _qi { my $__cq = 0; my $__cr = ""; my $__cs = ""; my $__ct = ""; my $__cu = ""; my %__cv = (); my $__cw = $authlib9_14_2::_ako->[0]; my $__cx = $__cw->{'_ld'}; my $__cy = @{$__cx}; my $__cz = 0; my $__da = 0; for($__cz = 0; $__cz < $__cy; $__cz++) { $__da = $__cx->[$__cz]; if ($__da->{'_pj'} != 21) { $__cv{$__da->{'_if'}} = 1; } } if ($authlib9_14_2::_aky) { if (exists $authlib9_14_2::_aky->{'_jr'}) { my $__db = $authlib9_14_2::_aky->{'_jr'}; my $__dc = 0; my $__dd = ""; foreach $__dc (@{$__db}) { $__dd = $__dc->{'_if'}; $__cv{$__dd} = 1; } } if (exists $authlib9_14_2::_aky->{'_ju'}) { my $__de = $authlib9_14_2::_aky->{'_ju'}; if (exists $__de->{'_w'}) { my @__df = @{$__de->{'_w'}}; my $__dg = 0; my $__dh = ""; foreach $__dg (@__df) { $__dh = $__dg->{'_if'}; $__cv{$__dh} = 1; } } } } foreach $__cr (sort keys %authlib9_14_2::_akn) { if ($__cr =~ m/^(.*?)_(.*?)$/) { $__cs = $1; } else { $__cs = $__cr; } if (exists $__cv{$__cs}) { $__ct = ""; $__cu = authlib9_14_2::_ws($__cr); if (exists $authlib9_14_2::_akn{$__cr}) { $__ct = $authlib9_14_2::_akn{$__cr}; } my $__di = authlib9_14_2::_zo(uc($__ct)); my $__dj = authlib9_14_2::_zo(uc($__cu)); if ($__di ne $__dj) { $__cq = 1; if (authlib9_14_2::_adv($__di) && authlib9_14_2::_adv($__dj)) { $__di = _qj($__di); $__dj = _qj($__dj); if ($__di eq $__dj) { $__cq = 0; } } if ($__cq) { last; } } } } return $__cq; } sub _qj { my ($__dk) = @_; if ($__dk =~ m/(\d*)(\.)(\d*?)(0+)$/) { if ($3 eq "") { $__dk = $1; } else { $__dk = $1 . $2 . $3; } } return $__dk; } sub _qk { my ($__dm, $__dn) = @_; my $__dl = ""; if (!(-e $__dn . "/" . $__dm)) { $__dl = "Cannot find library in " . $__dn; } eval { require $__dm; }; if ($@) { $__dl = $@; } if ($__dl ne "") { print "Content-type: text/html\r\n\r\n"; print "<html><body style=\"font-family: arial; margin: 20px;\">"; print "<span style=\"color: red; font-weight: bold; padding-right: 10px\">Error:</span>"; print "Cannot load library: <span style=\"color: blue;\">" . $__dm . "</span>"; print "</body></html>"; exit(); } } END { if ($authlib9_14_2::_ajm) { close $authlib9_14_2::_ajm; } } return 1; 1;
